<?xml version="1.0" encoding="UTF-8"?>
<PharmML xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.pharmml.org/2013/03/PharmML"
    xsi:schemaLocation="http://www.pharmml.org/2013/03/PharmML http://www.pharmml.org/2013/03/PharmML"
    xmlns:math="http://www.pharmml.org/2013/03/Maths"
    xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes"
    xmlns:ds="http://www.pharmml.org/2013/08/Dataset"
    xmlns:mdef="http://www.pharmml.org/2013/03/ModelDefinition"
    xmlns:mstep="http://www.pharmml.org/2013/03/ModellingSteps"
    xmlns:mml="http://www.pharmml.org/2013/03/PharmML"
    writtenVersion="0.3" id="i1">
    
    <!-- MODEL NAME -->
    <ct:Name>Chan, Holford model with NONMEM dataset.</ct:Name>
    
    <!-- INDEPENDENT VARIABLE -->
    <IndependentVariable symbId="t"/>

    <!-- MODEL DEFINITION -->
    <ModelDefinition xmlns="http://www.pharmml.org/2013/03/ModelDefinition">
        
        <!-- VARIABILITY MODEL -->
        <VariabilityModel blkId="randomEffect" type="parameterVariability">
            <Level symbId="occasion">
                <ParentLevel>
                    <ct:SymbRef symbIdRef="trial"/>
                </ParentLevel>
            </Level>
            <Level symbId="trial">
                <ParentLevel>
                    <ct:SymbRef symbIdRef="subject"/>
                </ParentLevel>
            </Level>
            <Level symbId="subject"/>
        </VariabilityModel>

        <VariabilityModel blkId="resError" type="residualError">
            <Level symbId="residual"/>
        </VariabilityModel>
        
        <!-- COVARIATE MODEL -->
        <!-- WEIGHT -->
        <CovariateModel blkId="cm1">
            <Covariate symbId="W">
                <Continuous>
                    <Transformation>
                        <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                            <Binop op="divide">
                                <ct:SymbRef symbIdRef="W"/>
                                <ct:Real>70</ct:Real>
                            </Binop>                                
                        </Equation>
                    </Transformation>
                </Continuous>
            </Covariate>
        </CovariateModel>
        <!-- SEX -->
        <CovariateModel blkId="cm2">
            <Covariate symbId="SEX">
                <Categorical>
                    <Category catId="F"/>
                </Categorical>
            </Covariate>
        </CovariateModel>
        <!-- AGE -->
        <CovariateModel blkId="cm3">
            <Covariate symbId="AGE">
                <Continuous>
                    <Transformation>
                        <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                            <Binop op="minus">
                                <ct:SymbRef symbIdRef="AGE"/>
                                <ct:Real>60</ct:Real>
                            </Binop>
                        </Equation>
                    </Transformation>
                </Continuous>
            </Covariate>
        </CovariateModel>
        <!-- DD -->
        <CovariateModel blkId="cm4">
            <Covariate symbId="DD">
                <Categorical>
                    <Category catId="YES"/>
                </Categorical>
            </Covariate>
        </CovariateModel>
        
        <!-- PARAMETER MODEL -->
        <ParameterModel blkId="pm1">
            <!-- TTK0 -->
            <SimpleParameter symbId="omega_TTK0"/>
            <SimpleParameter symbId="pop_TTK0"/>
            <RandomVariable symbId="eta_TTK0">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_TTK0"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <IndividualParameter symbId="TTK0">
                <GaussianModel>
                    <Transformation>log</Transformation>
                    <LinearCovariate>
                        <PopulationParameter>
                            <ct:Assign>
                                <ct:SymbRef symbIdRef="pop_TTK0"/>
                            </ct:Assign>
                        </PopulationParameter>
                    </LinearCovariate>
                    <RandomEffects>
                        <ct:SymbRef symbIdRef="eta_TTK0"/>
                    </RandomEffects>
                </GaussianModel>
            </IndividualParameter>
            
            <!-- Rsyn -->
            <SimpleParameter symbId="omega_Rsyn"/>
            <SimpleParameter symbId="pop_Rsyn"/>
            <RandomVariable symbId="eta_Rsyn">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_Rsyn"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <IndividualParameter symbId="Rsyn">
                <GaussianModel>
                    <Transformation>log</Transformation>
                    <LinearCovariate>
                        <PopulationParameter>
                            <ct:Assign>
                                <ct:SymbRef symbIdRef="pop_Rsyn"/>
                            </ct:Assign>
                        </PopulationParameter>
                    </LinearCovariate>
                    <RandomEffects>
                        <ct:SymbRef symbIdRef="eta_Rsyn"/>
                    </RandomEffects>
                </GaussianModel>
            </IndividualParameter>
            
            <!-- Css -->
            <SimpleParameter symbId="omega_Css"/>
            <SimpleParameter symbId="pop_Css"/>
            <RandomVariable symbId="eta_Css">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_Css"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <IndividualParameter symbId="Css">
                <GaussianModel>
                    <Transformation>log</Transformation>
                    <LinearCovariate>
                        <PopulationParameter>
                            <ct:Assign>
                                <ct:SymbRef symbIdRef="pop_Css"/>
                            </ct:Assign>
                        </PopulationParameter>
                    </LinearCovariate>
                    <RandomEffects>
                        <ct:SymbRef symbIdRef="eta_Css"/>
                    </RandomEffects>
                </GaussianModel>
            </IndividualParameter>
            
            <!-- V1 -->
            <SimpleParameter symbId="omega_V1"/>
            <SimpleParameter symbId="kappa1_V1"/>
            <SimpleParameter symbId="kappa2_V1"/>
            <SimpleParameter symbId="pop_V1"/>
            <SimpleParameter symbId="beta_V1_W"/>
            <SimpleParameter symbId="beta_V1_SEX"/>
            <SimpleParameter symbId="beta_V1_AGE"/>
            <SimpleParameter symbId="beta_V1_DD"/>
            <!-- eta_V1_indiv -->
            <RandomVariable symbId="eta_V1_indiv">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_V1"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_V1_trial -->
            <RandomVariable symbId="eta_V1_trial">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="trial"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa1_V1"/>                        
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_V1_occasion -->
            <RandomVariable symbId="eta_V1_occasion">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="occasion"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa2_V1"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <IndividualParameter symbId="V1">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="times">
                            <ct:SymbRef symbIdRef="pop_V1"/>
                            <Binop op="times">
                                <Binop op="power">
                                    <ct:SymbRef symbIdRef="W"/>
                                    <ct:SymbRef symbIdRef="beta_V1_W"/>
                                </Binop>
                                <Binop op="times">
                                    <Uniop op="exp">
                                        <Binop op="times">
                                            <ct:SymbRef symbIdRef="beta_V1_SEX"/>
                                            <ct:SymbRef blkIdRef="cm2" symbIdRef="SEX"/>
                                        </Binop>
                                    </Uniop>
                                    <Binop op="times">
                                        <Uniop op="exp">
                                            <Binop op="times">
                                                <ct:SymbRef symbIdRef="beta_V1_AGE"/>
                                                <ct:SymbRef blkIdRef="cm3" symbIdRef="AGE"/>
                                            </Binop>
                                        </Uniop>
                                        <Binop op="times">
                                            <Uniop op="exp">
                                                <Binop op="times">
                                                    <ct:SymbRef symbIdRef="beta_V1_DD"/>
                                                    <ct:SymbRef blkIdRef="cm4" symbIdRef="DD"/>
                                                </Binop>                                                
                                            </Uniop>
                                            <Binop op="times">
                                                <Uniop op="exp">
                                                    <ct:SymbRef symbIdRef="eta_V1_indiv"/>
                                                </Uniop>
                                                <Binop op="times">
                                                    <Uniop op="exp">
                                                        <ct:SymbRef symbIdRef="eta_V1_trial"/>
                                                    </Uniop>
                                                    <Uniop op="exp">
                                                        <ct:SymbRef symbIdRef="eta_V1_occasion"/>
                                                    </Uniop>
                                                </Binop>
                                            </Binop>
                                        </Binop>
                                    </Binop>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>                   
                </ct:Assign>
            </IndividualParameter>

            <!-- V2 -->
            <SimpleParameter symbId="omega_V2"/>
            <SimpleParameter symbId="kappa1_V2"/>
            <SimpleParameter symbId="kappa2_V2"/>
            <SimpleParameter symbId="pop_V2"/>
            <!-- eta_V2_indiv -->
            <RandomVariable symbId="eta_V2_indiv">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_V2"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_V2_trial -->
            <RandomVariable symbId="eta_V2_trial">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="trial"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa1_V2"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_V2_occasion -->
            <RandomVariable symbId="eta_V2_occasion">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="occasion"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa2_V2"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- V2 -->
            <IndividualParameter symbId="V2">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="times">
                            <ct:SymbRef symbIdRef="pop_V2"/>
                            <Binop op="times">
                                <Uniop op="exp">
                                    <ct:SymbRef symbIdRef="eta_V2_indiv"/>
                                </Uniop>
                                <Binop op="times">
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_V2_trial"/>
                                    </Uniop>
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_V2_occasion"/>
                                    </Uniop>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>                   
                </ct:Assign>
            </IndividualParameter>
            
            <!-- CL -->
            <SimpleParameter symbId="omega_CL"/>
            <SimpleParameter symbId="kappa1_CL"/>
            <SimpleParameter symbId="kappa2_CL"/>
            <SimpleParameter symbId="pop_CL"/>
            <!-- eta_CL_indiv -->
            <RandomVariable symbId="eta_CL_indiv">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_CL"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_CL_trial -->
            <RandomVariable symbId="eta_CL_trial">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="trial"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa1_CL"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_CL_occasion -->
            <RandomVariable symbId="eta_CL_occasion">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="occasion"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa2_CL"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- CL -->
            <IndividualParameter symbId="CL">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="times">
                            <ct:SymbRef symbIdRef="pop_CL"/>
                            <Binop op="times">
                                <Uniop op="exp">
                                    <ct:SymbRef symbIdRef="eta_CL_indiv"/>
                                </Uniop>
                                <Binop op="times">
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_CL_trial"/>
                                    </Uniop>
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_CL_occasion"/>
                                    </Uniop>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>                   
                </ct:Assign>
            </IndividualParameter>
            
            <!-- Q -->
            <SimpleParameter symbId="omega_Q"/>
            <SimpleParameter symbId="kappa1_Q"/>
            <SimpleParameter symbId="kappa2_Q"/>
            <SimpleParameter symbId="pop_Q"/>
            <!-- eta_Q_indiv -->
            <RandomVariable symbId="eta_Q_indiv">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="omega_Q"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_Q_trial -->
            <RandomVariable symbId="eta_Q_trial">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="trial"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa1_Q"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- eta_Q_occasion -->
            <RandomVariable symbId="eta_Q_occasion">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="occasion"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <var varId="kappa2_Q"/>
                    </variance>
                </NormalDistribution>
            </RandomVariable>
            <!-- Q -->
            <IndividualParameter symbId="Q">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="times">
                            <ct:SymbRef symbIdRef="pop_Q"/>
                            <Binop op="times">
                                <Uniop op="exp">
                                    <ct:SymbRef symbIdRef="eta_Q_indiv"/>
                                </Uniop>
                                <Binop op="times">
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_Q_trial"/>
                                    </Uniop>
                                    <Uniop op="exp">
                                        <ct:SymbRef symbIdRef="eta_Q_occasion"/>
                                    </Uniop>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>                   
                </ct:Assign>
            </IndividualParameter>
            
            <SimpleParameter symbId="BSVV1"/>
            <SimpleParameter symbId="BSVCL"/>
            <SimpleParameter symbId="BSVV2"/>
            <SimpleParameter symbId="BSVQ"/>
            
<!--            matrix(name="struc1",type="VAR") {
            BSVV1=0.015,                            # 1
            0.00377, BSVCL=0.0158,                  # 2
            0.0156, 0.0127, BSVV2=0.0218,           # 3
            0.0273, 0.0282, 0.0411, BSVQ=0.0804     # 4
            } # end matrix struc1-->
<!--        BSVV1 = omega_V1
            BSVCL = omega_CL
            BSVV2 = omega_V2
            BSVQ = omega_Q  -->
            <Correlation>
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="subject"/>
                </ct:VariabilityReference>                
                <Matrix matrixType="CovMatrix">
                    <ct:RowNames>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V1_indiv"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_CL_indiv"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V2_indiv"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_Q_indiv"/>
                    </ct:RowNames>
                    <ct:MatrixRow>
                        <ct:SymbRef symbIdRef="omega_V1"/>
                    </ct:MatrixRow>
                    <ct:MatrixRow>
                        <ct:Real>0.00377</ct:Real><ct:SymbRef symbIdRef="omega_CL"/>
                    </ct:MatrixRow>
                    <ct:MatrixRow>
                        <ct:Real>0.0156</ct:Real><ct:Real>0.0127</ct:Real><ct:SymbRef symbIdRef="omega_V2"/>
                    </ct:MatrixRow>
                    <ct:MatrixRow>
                        <ct:Real>0.0273</ct:Real><ct:Real>0.0282</ct:Real><ct:Real>0.0411</ct:Real><ct:SymbRef symbIdRef="omega_Q"/>
                    </ct:MatrixRow>
                </Matrix>            
            </Correlation>
            
<!--            matrix(name="struc2",type="VAR") {
            BOVV11=0.0254,                          # 5;Occasion 1 0 month visit 1st infusion
            0.0152, BOVCL1=0.016,                   # 6
            0.011, 0.0102, BOVV21=0.00667,          # 7
            0.0275, 0.0137, 0.0105, BOVQ1=0.0313    # 8
            } # end matrix struc2-->
<!--        BOVV11 = kappa1_V1
            BOVCL1 = kappa1_CL
            BOVV21 = kappa1_V2
            BOVQ1 = kappa1_Q   -->
            <Correlation>
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="trial"/>
                </ct:VariabilityReference>
                <Matrix matrixType="CovMatrix">
                    <ct:RowNames>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V1_trial"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_CL_trial"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V2_trial"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_Q_trial"/>
                    </ct:RowNames>
                    <ct:MatrixRow>
                        <ct:SymbRef symbIdRef="kappa1_V1"/>
                        <ct:Real>0.0152</ct:Real><ct:SymbRef symbIdRef="kappa1_CL"/>
                        <ct:Real>0.011</ct:Real><ct:Real>0.0102</ct:Real><ct:SymbRef symbIdRef="kappa1_V2"/>
                        <ct:Real>0.0275</ct:Real><ct:Real>0.0137</ct:Real><ct:Real>0.0105</ct:Real><ct:SymbRef symbIdRef="kappa1_Q"/>
                    </ct:MatrixRow>
                </Matrix>
            </Correlation>
            
<!--            matrix(name="struc12",type="VAR") {
            PPV_BTVV11=0.156,                       # 48
            0.0407, PPV_BTVCL1=0.0292,              # 49
            0.018, 0.0273, PPV_BTVV21=0.043,        # 50
            -0.059, 0.0203, 0.0545, PPV_BTVQ1=0.115 # 51
            } # end matrix struc12-->
<!--        PPV_BOVV11 = kappa2_V1
            PPV_BOVCL1 = kappa2_CL
            PPV_BOVV21 = kappa2_V2
            PPV_BOVQ1 = kappa2_Q   -->
            <Correlation>
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="randomEffect" symbIdRef="occasion"/>
                </ct:VariabilityReference>
                <Matrix matrixType="CovMatrix">
                    <ct:RowNames>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V1_occasion"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_CL_occasion"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_V2_occasion"/>
                        <ct:SymbRef blkIdRef="pm1" symbIdRef="eta_Q_occasion"/>
                    </ct:RowNames>
                    <ct:MatrixRow>
                        <ct:SymbRef symbIdRef="kappa2_V1"/>
                        <ct:Real>0.0407</ct:Real><ct:SymbRef symbIdRef="kappa2_CL"/>
                        <ct:Real>0.018</ct:Real><ct:Real>0.0273</ct:Real><ct:SymbRef symbIdRef="kappa2_V2"/>
                        <ct:Real>-0.059</ct:Real><ct:Real>0.0203</ct:Real><ct:Real>0.0545</ct:Real><ct:SymbRef symbIdRef="kappa2_Q"/>
                    </ct:MatrixRow>
                </Matrix>
            </Correlation>
            
        </ParameterModel>
                
        <!-- STRUCTURAL MODEL -->
        <StructuralModel blkId="sm1">
            
            <!-- Ac -->
            <ct:DerivativeVariable symbolType="real" symbId="Ac">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">  
                            <Binop op="minus">
                                <Binop op="times">
                                    <Binop op="divide">
                                        <ct:SymbRef blkIdRef="pm1" symbIdRef="Q"/>
                                        <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                    </Binop>
                                    <ct:SymbRef symbIdRef="Ap"/>
                                </Binop>
                                <Binop op="minus">
                                    <Binop op="times">
                                        <Binop op="divide">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Q"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <ct:SymbRef symbIdRef="Ac"/>
                                    </Binop>
                                    <Binop op="times">
                                        <Binop op="divide">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="CL"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <ct:SymbRef symbIdRef="Ac"/>
                                    </Binop>
                                </Binop>
                            </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <Equation xmlns="http://www.pharmml.org/2013/03/Maths">                          
                                <Piecewise>
                                    <Piece>
                                        <ct:Real>0</ct:Real>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>0</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>409</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>1909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>3909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                </Piecewise>
                            </Equation>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <!-- Ap -->
            <ct:DerivativeVariable symbId="Ap" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <Binop op="divide">
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="Q"/>
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="Ac"/>
                            </Binop>
                            <Binop op="times">
                                <Binop op="divide">
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="Q"/>
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="Ap"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="time"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <Equation xmlns="http://www.pharmml.org/2013/03/Maths">                          
                                <Piecewise>
                                    <Piece>
                                        <ct:Real>0</ct:Real>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>0</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>409</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>1909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                    <Piece>
                                        <Binop op="times">
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="Css"/>
                                            <ct:SymbRef blkIdRef="pm1" symbIdRef="V2"/>
                                        </Binop>
                                        <Condition>
                                            <LogicBinop op="eq">
                                                <ct:SymbRef symbIdRef="t"/>
                                                <ct:Real>3909</ct:Real>
                                            </LogicBinop>
                                        </Condition>
                                    </Piece>
                                </Piecewise>
                            </Equation>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <!-- C -->
            <ct:Variable symbolType="real" symbId="C"> <!-- C = Rsyn/CL * V1 + Ac/V1 -->
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="plus">
                            <Binop op="times">
                                <Binop op="divide">
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="Rsyn"/>
                                    <ct:SymbRef blkIdRef="pm1" symbIdRef="CL"/>
                                </Binop>
                                <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                            </Binop>
                            <Binop op="divide">
                                <ct:SymbRef symbIdRef="Ac"/>
                                <ct:SymbRef blkIdRef="pm1" symbIdRef="V1"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
            </ct:Variable>                
            
        </StructuralModel>
        
        <!-- OBSERVATION MODEL -->
        <ObservationModel blkId="om1">
            <SimpleParameter symbId="a"/>
            <SimpleParameter symbId="b"/>
            <RandomVariable symbId="epsilon1">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="resError" symbIdRef="residual"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <stddev>
                        <prVal>1</prVal>
                    </stddev>
                </NormalDistribution>
            </RandomVariable>
            <RandomVariable symbId="epsilon2">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="resError" symbIdRef="residual"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <stddev>
                        <prVal>1</prVal>
                    </stddev>
                </NormalDistribution>
            </RandomVariable>
            <General symbId="C_obs"> 
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="plus">
                            <ct:SymbRef blkIdRef="sm1" symbIdRef="C"/>
                            <Binop op="plus">
                                <Binop op="times">
                                    <ct:SymbRef symbIdRef="a"/>
                                    <ct:SymbRef symbIdRef="epsilon1"/>
                                </Binop>
                                <Binop op="times">
                                    <ct:SymbRef symbIdRef="b"/>
                                    <Binop op="times">
                                        <ct:SymbRef blkIdRef="sm1" symbIdRef="C"/>
                                        <ct:SymbRef symbIdRef="epsilon2"/>
                                    </Binop>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
            </General>
        </ObservationModel>
        
    </ModelDefinition>
    
    
    <ModellingSteps xmlns="http://www.pharmml.org/2013/03/ModellingSteps">
        <
        <!-- NONMEM OBJECTIVE DATA -->
        <NONMEMdataSet oid="NMoid">
            
            <!-- NM dataset mapping -->
            <ColumnMapping>
                <ds:ColumnRef columnIdRef="WTKG"/>
                <ct:SymbRef blkIdRef="cm1" symbIdRef="W"/>
            </ColumnMapping>
            <ColumnMapping>
                <ds:ColumnRef columnIdRef="TIME"/>
                <ct:SymbRef symbIdRef="t"/>
            </ColumnMapping>
            <ColumnMapping>
                <ds:ColumnRef columnIdRef="DV"/>
                <ct:SymbRef blkIdRef="om1" symbIdRef="C_obs"/>
            </ColumnMapping>
            
            <!-- Dataset definition -->
            <ds:DataSet>
                <ds:Definition>
                    <ds:Column columnId="ID" columnType="id" valueType="id" columnNum="1"/>
                    <ds:Column columnId="MONTH" columnType="covariate" valueType="real" columnNum="2"/>
                    <ds:Column columnId="TRIAL" columnType="covariate" valueType="real" columnNum="3"/>
                    <ds:Column columnId="OCC" columnType="occasion" valueType="real" columnNum="4"/>
                    <ds:Column columnId="WTKG" columnType="covariate" valueType="real" columnNum="5"/>
                    <ds:Column columnId="PREV" columnType="covariate" valueType="real" columnNum="6"/>
                    <ds:Column columnId="TIME" columnType="time" valueType="real" columnNum="7"/>
                    <ds:Column columnId="AMT" columnType="dose" valueType="real" columnNum="8"/>
                    <ds:Column columnId="RATE" columnType="rate" valueType="real" columnNum="9"/>
                    <ds:Column columnId="SS" columnType="ss" valueType="real" columnNum="10"/>
                    <ds:Column columnId="DV" columnType="dv" valueType="real" columnNum="13"/>
                    <ds:Column columnId="MDV" columnType="mdv" valueType="real" columnNum="14"/>
                </ds:Definition>
                <ds:ImportData oid="id1">
                    <ds:name>warfarin_conc_pca</ds:name>
                    <ds:url>./../examples_0_2_2/datasets/</ds:url>
                    <ds:format>CSV</ds:format>
                    <ds:delimiter>COMMA</ds:delimiter>
                </ds:ImportData>
            </ds:DataSet>
            <!-- Code injection -->
            <CodeInjection>
                <!-- TTK0, CSS and CL are mapped to the ParameterModel 'pm1' -->
                <SymbolMapping>
                    <ct:SymbRef symbIdRef="TTK0"/>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="TTK0"/>
                </SymbolMapping>
                <SymbolMapping>
                    <ct:SymbRef symbIdRef="CSS"/>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="CSS"/>
                </SymbolMapping>
                <SymbolMapping>
                    <ct:SymbRef symbIdRef="CL"/>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="CL"/>
                </SymbolMapping>
                <!-- PRED is mapped to the dataset column define above -->
                <SymbolMapping>
                    <ct:SymbRef symbIdRef="PRED"/>
                    <ds:ColumnRef columnIdRef="PRED"/>
                </SymbolMapping>
                <!-- The following symbols are extracted from the injected code -->
                <TargetCode>
                    <Symbol symbId="CSS"/>
                    <Symbol symbId="TTK0"/>
                    <Symbol symbId="CL"/>
                    <Symbol symbId="PRED"/>
                    <Symbol symbId="D1"/>
                    <Symbol symbId="R1"/>
                    <Code>
                        <![CDATA[
                                if (PRED==0) {
                                D1=TTK0
                                } else {
                                R1=CL*CSS
                                }                    
                            ]]>
                    </Code>
                </TargetCode>
            </CodeInjection>
        </NONMEMdataSet>
        
        <EstimationStep oid="estStep">
            
            <TargetToolReference>
                <ct:OidRef oidRef="NMoid"/>
            </TargetToolReference>
            
            <!-- PARAMETERS TO ESTIMATE -->
            <ParametersToEstimate>
<!--            POP_V1=list(value=11.4,lo=0.02,hi=100) # 1 ;Central compartment volume
                POP_CL=list(value=30.9,lo=0.02,hi=500) # 2 ;Elimination clearance
                POP_V2=list(value=27.3,lo=0.02,hi=100) # 3 ;Tissue compartment volume
                POP_Q=list(value=34.6,lo=0.02,hi=100) # 4 ;Intercompartmental clearance
                POP_TTK0=list(value=2 ,fix=true) # 5 ;Duration of infusion
                POP_RSYN=list(value=3.42,lo=0,hi=10) # 6 ;Endogenous ldopa input
                POP_CSSOP=list(value=0.075,lo=0,hi=1) # 7 ;Css from previous dosing-->
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="pop_V1"/>
                    <InitialEstimate>
                        <ct:Real>11.4</ct:Real>
                    </InitialEstimate>
                    <LowerBound>
                        <ct:Real>0.02</ct:Real>
                    </LowerBound>
                    <UpperBound>
                        <ct:Real>100</ct:Real>
                    </UpperBound>
                </ParameterEstimation>
                
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="BSVV1"/>
                    <InitialEstimate>
                        <ct:Real>0.015</ct:Real>                        
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="BSVCL"/>
                    <InitialEstimate>
                        <ct:Real>0.0158</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="BSVV2"/>
                    <InitialEstimate>
                        <ct:Real>0.0218</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="BSVQ"/>
                    <InitialEstimate>
                        <ct:Real>0.0804</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="omega_Q"/>
                    <InitialEstimate>
                        <ct:Real>1</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="omega_V"/>
                    <InitialEstimate>
                        <ct:Real>5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="kappa1_V"/>
                    <InitialEstimate>
                        <ct:Real>5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="kappa2_V"/>
                    <InitialEstimate>
                        <ct:Real>5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="beta_V_W"/>
                    <InitialEstimate>
                        <ct:Real>.5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="beta_V_SEX"/>
                    <InitialEstimate>
                        <ct:Real>.5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="beta_V_AGE"/>
                    <InitialEstimate>
                        <ct:Real>.5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef blkIdRef="pm1" symbIdRef="beta_V_DD"/>
                    <InitialEstimate>
                        <ct:Real>.5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
            </ParametersToEstimate>
            <Operation order="1" opType="estPop"/>
        </EstimationStep>
        <StepDependencies>
            <Step>
                <ct:OidRef oidRef="estStep"/>
            </Step>
        </StepDependencies>
    </ModellingSteps>
</PharmML>

