<?xml version="1.0" encoding="UTF-8"?>

<PharmML xmlns="http://www.pharmml.org/2013/03/PharmML"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.pharmml.org/2013/03/PharmML http://www.pharmml.org/2013/03/PharmML"
    xmlns:ct="http://www.pharmml.org/2013/03/CommonTypes"
    writtenVersion="0.3" id="i1">

    <ct:Name>Simeoni - CR 2004</ct:Name>
    
    <ct:Description>TGI - paclitaxel drug</ct:Description>
    
    <!-- intependent variable -->
    <IndependentVariable symbId="t"/>
    
    <ct:FunctionDefinition symbolType="real" symbId="proportionalErrorModel">
        <ct:FunctionArgument symbolType="real" symbId="b"/>
        <ct:FunctionArgument symbolType="real" symbId="f"/>
        <ct:Definition>
            <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                <Binop op="times">
                    <ct:SymbRef symbIdRef="b"/>
                    <ct:SymbRef symbIdRef="f"/>
                </Binop>
            </Equation>
        </ct:Definition>
    </ct:FunctionDefinition>
    
    <ct:FunctionDefinition symbolType="real" symbId="f_p">
        <ct:FunctionArgument symbolType="real" symbId="l0"/>
        <ct:FunctionArgument symbolType="real" symbId="l1"/>
        <ct:FunctionArgument symbolType="real" symbId="w"/>
        <ct:FunctionArgument symbolType="real" symbId="x"/>
        <ct:FunctionArgument symbolType="real" symbId="p"/>
        <ct:Definition>
            <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                <Binop op="divide">
                    <Binop op="times">
                        <ct:SymbRef symbIdRef="l0"/>
                        <ct:SymbRef symbIdRef="x"/>
                    </Binop>
                    <Binop op="power">
                        <Binop op="plus">
                            <ct:Real>1</ct:Real>
                            <Binop op="power">
                                <Binop op="times">
                                    <Binop op="divide">
                                        <ct:SymbRef symbIdRef="l0"/>
                                        <ct:SymbRef symbIdRef="l1"/>
                                    </Binop>
                                    <ct:SymbRef symbIdRef="w"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="p"/>
                            </Binop>
                        </Binop>
                        <Binop op="divide">
                            <ct:Real>1</ct:Real>
                            <ct:SymbRef symbIdRef="p"/>
                        </Binop>
                    </Binop>
                </Binop>
            </Equation>
        </ct:Definition>
    </ct:FunctionDefinition>
    
    <ModelDefinition xmlns="http://www.pharmml.org/2013/03/ModelDefinition">
        
        <VariabilityModel blkId="resErrorModel" type="residualError"> 
            <Level symbId="residual"/>
        </VariabilityModel>
        
        <ParameterModel blkId="pm1">
            
            <SimpleParameter symbId="k10">
                <ct:Assign>
                    <ct:Real>0.868</ct:Real>
                </ct:Assign>
            </SimpleParameter>
            <SimpleParameter symbId="k12">
                <ct:Assign>
                    <ct:Real>0.006</ct:Real>
                </ct:Assign>
            </SimpleParameter>
            <SimpleParameter symbId="k21">
                <ct:Assign>
                    <ct:Real>0.0838</ct:Real>
                </ct:Assign>
            </SimpleParameter>
            <SimpleParameter symbId="V1">
                <ct:Assign>
                    <ct:Real>0.81</ct:Real>
                </ct:Assign>
            </SimpleParameter>            
            
            <SimpleParameter symbId="lambda0"/>
            <SimpleParameter symbId="lambda1"/>
            <SimpleParameter symbId="w0"/>
            <SimpleParameter symbId="k1"/>
            <SimpleParameter symbId="k2"/>
            <SimpleParameter symbId="psi">
                <ct:Assign>
                    <ct:Real>20</ct:Real>
                </ct:Assign>
            </SimpleParameter>
        </ParameterModel>
        
        <StructuralModel blkId="sm1">
            
            <ct:DerivativeVariable symbId="Q1" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k21" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="Q2"/>
                            </Binop>
                            <Binop op="times">
                                <Binop op="plus">
                                    <ct:SymbRef symbIdRef="k10" blkIdRef="pm1"/>
                                    <ct:SymbRef symbIdRef="k12" blkIdRef="pm1"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="Q1"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <ct:Real>0</ct:Real>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <ct:DerivativeVariable symbId="Q2" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k12" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="Q1"/>
                            </Binop>
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k21" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="Q2"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <ct:Real>0</ct:Real>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>

            <ct:Variable symbId="C" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="divide">
                            <ct:SymbRef symbIdRef="Q1"/>
                            <ct:SymbRef symbIdRef="V1" blkIdRef="pm1"/>
                        </Binop>
                    </Equation>
                </ct:Assign>
            </ct:Variable>
            
            <ct:DerivativeVariable symbId="x1" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <FunctionCall>
                                <ct:SymbRef symbIdRef="f_p"/>
                                <FunctionArgument symbId="l0">
                                    <ct:SymbRef symbIdRef="lambda0" blkIdRef="pm1"/>
                                </FunctionArgument>
                                <FunctionArgument symbId="l1">
                                    <ct:SymbRef symbIdRef="lambda1" blkIdRef="pm1"/>
                                </FunctionArgument>
                                <FunctionArgument symbId="w">
                                    <ct:SymbRef symbIdRef="W"/>
                                </FunctionArgument>
                                <FunctionArgument symbId="x">
                                    <ct:SymbRef symbIdRef="x1"/>
                                </FunctionArgument>
                                <FunctionArgument symbId="p">
                                    <ct:SymbRef symbIdRef="psi" blkIdRef="pm1"/>
                                </FunctionArgument>
                            </FunctionCall>
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k2" blkIdRef="pm1"/>
                                <Binop op="times">
                                    <ct:SymbRef symbIdRef="C"/>
                                    <ct:SymbRef symbIdRef="x1"/>
                                </Binop>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <ct:SymbRef symbIdRef="w0" blkIdRef="pm1"/>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <ct:DerivativeVariable symbId="x2" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <Binop op="times">
                                    <ct:SymbRef symbIdRef="k2" blkIdRef="pm1"/>
                                    <ct:SymbRef symbIdRef="C"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="x1"/>
                            </Binop>
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="x2"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <ct:Real>0</ct:Real>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <ct:DerivativeVariable symbId="x3" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="x2"/>
                            </Binop>
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="x3"/>
                            </Binop>
                        </Binop>
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign><ct:Real>0</ct:Real></ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <ct:DerivativeVariable symbId="x4" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="minus">
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="x3"/>
                            </Binop>
                            <Binop op="times">
                                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                                <ct:SymbRef symbIdRef="x4"/>
                            </Binop>
                        </Binop>  
                    </Equation>
                </ct:Assign>
                <ct:IndependentVariable>
                    <ct:SymbRef symbIdRef="t"/>
                </ct:IndependentVariable>
                <ct:InitialCondition>
                    <ct:InitialValue>
                        <ct:Assign>
                            <ct:Real>0</ct:Real>
                        </ct:Assign>
                    </ct:InitialValue>
                </ct:InitialCondition>
            </ct:DerivativeVariable>
            
            <ct:Variable symbId="W" symbolType="real">
                <ct:Assign>
                    <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                        <Binop op="plus">
                            <Binop op="plus">
                                <Binop op="plus">
                                    <ct:SymbRef symbIdRef="x1"/>
                                    <ct:SymbRef symbIdRef="x2"/>
                                </Binop>
                                <ct:SymbRef symbIdRef="x3"/>
                            </Binop>	
                            <ct:SymbRef symbIdRef="x4"/>
                        </Binop>
                    </Equation>
                </ct:Assign>
            </ct:Variable>
            
        </StructuralModel>
        
        
        <ObservationModel blkId="om1">
            <SimpleParameter symbId="CV"/>
            
            <RandomVariable symbId="epsilon">
                <ct:VariabilityReference>
                    <ct:SymbRef blkIdRef="resErrorModel" symbIdRef="residual"/>
                </ct:VariabilityReference>
                <NormalDistribution xmlns="http://www.uncertml.org/3.0" definition="http://www.uncertml.org/distributions/normal">
                    <mean>
                        <rVal>0</rVal>
                    </mean>
                    <variance>
                        <prVal>1</prVal>
                    </variance>                    
                </NormalDistribution>
            </RandomVariable>
            <Standard symbId="y">
                <Output>
                    <ct:SymbRef symbIdRef="W" blkIdRef="sm1"/>
                </Output>
                <!-- Assegno b ed f del proportionalErrorModel(f è la predizione del modello) -->
                <ErrorModel>
                    <ct:Assign>
                        <Equation xmlns="http://www.pharmml.org/2013/03/Maths">
                            <FunctionCall>
                                <ct:SymbRef symbIdRef="proportionalErrorModel"/>
                                <FunctionArgument symbId="b">
                                    <ct:SymbRef symbIdRef="CV"/>
                                </FunctionArgument>
                                <FunctionArgument symbId="f">
                                    <ct:SymbRef symbIdRef="W" blkIdRef="sm1"/>
                                </FunctionArgument>
                            </FunctionCall>
                        </Equation>
                    </ct:Assign>
                </ErrorModel>
                <ResidualError>
                    <ct:SymbRef symbIdRef="epsilon"/>
                </ResidualError>
            </Standard>
        </ObservationModel>
    </ModelDefinition>
    
    <TrialDesign xmlns="http://www.pharmml.org/2013/03/TrialDesign">
        <Structure>
            <Epoch oid="e1">
                <Start>
                    <ct:Real>0</ct:Real>
                </Start>
                <End>
                    <ct:Real>40</ct:Real> <!-- last time point of PD simulated data -->
                </End>
                <Order>1</Order>
            </Epoch>
            <Arm oid="control"/>
            <Arm oid="treatment"/>
            <Cell oid="c1">
                <EpochRef oidRef="e1"/>
                <ArmRef oidRef="control"/>
                <SegmentRef oidRef="s1"/>
            </Cell>
            <Cell oid="c2">
                <EpochRef oidRef="e1"/>
                <ArmRef oidRef="treatment"/>
                <SegmentRef oidRef="s2"/>
            </Cell>
            <Segment oid="s1">
                <ActivityRef oidRef="act_wash"/>
            </Segment>
            <Segment oid="s2">
                <ActivityRef oidRef="act_drug"/>
            </Segment>
            <Activity oid="act_wash">
                <Washout/>
            </Activity>
            <Activity oid="act_drug">
                <Bolus>
                    <DoseAmount inputTarget="derivativeVariable">
                        <ct:SymbRef symbIdRef="Q1" blkIdRef="sm1"/>
                        <ct:Assign>
                            <ct:Real>30</ct:Real> <!-- mg/kg -->
                        </ct:Assign>
                    </DoseAmount>
                    <DosingTimes>
                        <ct:Assign>
                            <ct:Vector>
                                <ct:Real>8</ct:Real>
                                <ct:Real>12</ct:Real>
                                <ct:Real>16</ct:Real>
                            </ct:Vector>                          
                        </ct:Assign>
                    </DosingTimes>
                </Bolus>
            </Activity>
        </Structure>
        
        <Population>
            <DataSet xmlns="http://www.pharmml.org/2013/08/Dataset">
                <Definition>
                    <Column columnId="ID" columnType="id" valueType="id" columnNum="1"/>
                    <Column columnId="ARM" columnType="arm" valueType="id" columnNum="2"/>
                </Definition>
                <Table>
                    <Row>
                        <ct:Id>i1</ct:Id>
                        <ct:Id>control</ct:Id>
                    </Row>
                    <Row>
                        <ct:Id>i2</ct:Id>
                        <ct:Id>treatment</ct:Id>
                    </Row>
                </Table>
            </DataSet>
        </Population>
        
    </TrialDesign>
    
    <ModellingSteps xmlns="http://www.pharmml.org/2013/03/ModellingSteps">
        
        <SimulationStep oid="sim1">
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="lambda0" blkIdRef="pm1"/>
                <ct:Assign>
                    <ct:Real>0.273</ct:Real>
                </ct:Assign>
            </ct:VariableAssignment>
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="lambda1" blkIdRef="pm1"/>
                <ct:Assign>
                    <ct:Real>0.814</ct:Real>
                </ct:Assign>
            </ct:VariableAssignment>
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="w0" blkIdRef="pm1"/>
                <ct:Assign>
                    <ct:Real>0.055</ct:Real>
                </ct:Assign>
            </ct:VariableAssignment>
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                <ct:Assign>
                    <ct:Real>0.968</ct:Real>
                </ct:Assign>
            </ct:VariableAssignment>
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="k2" blkIdRef="pm1"/>
                <ct:Assign>
                    <ct:Real>0.629</ct:Real> <!-- ml day-1 micrograms-1 -->
                </ct:Assign>
            </ct:VariableAssignment>
            <ct:VariableAssignment>
                <ct:SymbRef symbIdRef="CV" blkIdRef="om1"/>
                <ct:Assign>
                    <ct:Real>0.1</ct:Real>
                </ct:Assign>
            </ct:VariableAssignment>
            <Observations>
                <Timepoints>
                    <ct:Vector>
                        <ct:Sequence>
                            <ct:Begin><ct:Int>0</ct:Int></ct:Begin>
                            <ct:StepSize><ct:Int>1</ct:Int></ct:StepSize>
                            <ct:End><ct:Int>40</ct:Int></ct:End>
                        </ct:Sequence>
                    </ct:Vector>
                </Timepoints>
                <Continuous>
                    <ct:SymbRef symbIdRef="W" blkIdRef="sm1"/>
                    <ct:SymbRef symbIdRef="y" blkIdRef="om1"/>
                </Continuous>
            </Observations>
        </SimulationStep>



        <!-- Stima -->
        <EstimationStep oid="est1">
            <!-- Data Set per la stima -->
            <ObjectiveDataSet>
                <ColumnMapping>
                    <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="time"/>
                    <ct:SymbRef symbIdRef="t"/>
                    <!-- tempo variabile globale non specifico il blocco di riferimento -->
                </ColumnMapping>
                <ColumnMapping>
                    <ColumnRef xmlns="http://www.pharmml.org/2013/08/Dataset" columnIdRef="weight"/>
                    <ct:SymbRef symbIdRef="y" blkIdRef="om1"/>
                </ColumnMapping>
                <DataSet xmlns="http://www.pharmml.org/2013/08/Dataset">
                    <Definition>
                        <Column columnId="ID" columnType="id" valueType="id" columnNum="1"/>
                        <Column columnId="time" columnType="idv" valueType="real" columnNum="2"/>
                        <Column columnId="weight" columnType="dv" valueType="real" columnNum="3"/>
                    </Definition>
                    <Table>
                        <Row><ct:Id>i1</ct:Id><ct:Real>8</ct:Real><ct:Real>0.083</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>10</ct:Real><ct:Real>0.12</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>13</ct:Real><ct:Real>0.3</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>15</ct:Real><ct:Real>0.62</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>18</ct:Real><ct:Real>1.2</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>22</ct:Real><ct:Real>2.75</ct:Real></Row>
                        <Row><ct:Id>i1</ct:Id><ct:Real>26</ct:Real><ct:Real>4.9</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>8</ct:Real><ct:Real>0.093</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>10</ct:Real><ct:Real>0.15</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>13</ct:Real><ct:Real>0.25</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>15</ct:Real><ct:Real>0.23</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>18</ct:Real><ct:Real>0.16</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>22</ct:Real><ct:Real>0.11</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>26</ct:Real><ct:Real>0.3</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>30</ct:Real><ct:Real>0.8</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>35</ct:Real><ct:Real>2.5</ct:Real></Row>
                        <Row><ct:Id>i2</ct:Id><ct:Real>40</ct:Real><ct:Real>5.8</ct:Real></Row>
                    </Table>
                </DataSet>
            </ObjectiveDataSet>
            <ParametersToEstimate>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="lambda0" blkIdRef="pm1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.3</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="lambda1" blkIdRef="pm1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.3</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>   
                    <ct:SymbRef symbIdRef="w0" blkIdRef="pm1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.02</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="k1" blkIdRef="pm1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.3</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="k2" blkIdRef="pm1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.5</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
                <ParameterEstimation>
                    <ct:SymbRef symbIdRef="CV" blkIdRef="om1"/>
                    <InitialEstimate fixed="false">
                        <ct:Real>0.1</ct:Real>
                    </InitialEstimate>
                </ParameterEstimation>
            </ParametersToEstimate>
            
            <Operation order="1" opType="estIndiv"/>
        </EstimationStep>
        
        <StepDependencies>
            <Step>
                <ct:OidRef oidRef="est1"/>
            </Step>
            <Step>
                <ct:OidRef oidRef="sim1"/>
            </Step>
        </StepDependencies>
        
    </ModellingSteps>
    
</PharmML>
