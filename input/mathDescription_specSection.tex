\chapter{Mathematical Representation}
\label{chap:mathsdefn}

\begin{quote}
{\small
All models are wrong but some are useful\\
\textit{George E.P. Box} }
\end{quote}

\section{Introduction}
This chapter deals with the mathematical description of models which can be encoded in PharmML. The figure 
\ref{fig:indivModel} visualises the task every modeller is faced with -- find a model (solid line) which explains the experimental data (diamonds). A perfect mathematical model, given error free experimental measurements, would explain the underlying mechanism and therefore fit every measurement. The complexity of the human body makes detailed mechanistic representation impossible, so the models we use are only approximations of a physiological system under consideration with multiple sources of uncertainty we have to account for, see Figure \ref{fig:basicEquation}.\\
%
%{\Large
%\begin{eqnarray}
%&& Experimental \;data = Model \;Prediction + Error \nonumber
%\end{eqnarray}
%}
\begin{figure}[htbp]
\centering
 \includegraphics[height=10mm]{ModelEquation}
\caption{A basic equation visualising the relationship between experimental data and model prediction.}
%\caption{Basic mathematical model for frequently sampled individual data. The black diamonds stand for experimental data, the solid line for the time course of concentration as predicted by a mathematical model.}
\label{fig:basicEquation}
\end{figure}
Additional aspect is the difference between individual and population approach. In the former case, usually when dealing with animal or preclinical studies, frequently sampled data is available and one can estimate individual's PK and PD parameters, see Figure \ref{fig:indivModel}. In clinical practise however, the situation is quite different, Figure \ref{fig:popModel}. More data records in total are available but it's often impossible to estimate subject specific parameters. Instead, the data provides valuable information on the inter-individual variability. 
\begin{figure}[htbp]
\centering
 \includegraphics[height=45mm]{Model_individual}
\caption{Frequently sampled individual PK data. The black diamonds stand for experimental data, the solid line for the time course of concentration as predicted by a mathematical model. }
%\caption{Basic mathematical model for frequently sampled individual data. The black diamonds stand for experimental data, the solid line for the time course of concentration as predicted by a mathematical model.}
\label{fig:indivModel}
\end{figure}

\begin{figure}[htbp]
\centering
 \includegraphics[height=45mm]{Model_population}
\caption{Population PK data --  for three subjects with different observation times and varying characteristics, such as area under the curve, maximum values, time of the maximum etc. The grey line of the population average is to be estimated along with individual estimates.}
%\caption{Basic mathematical model for frequently sampled individual data. The black diamonds stand for experimental data, the solid line for the time course of concentration as predicted by a mathematical model.}
\label{fig:popModel}
\end{figure}

\section{Non-linear mixed effect models}

The approach which proved to be very effective for the analysis of population data is that of \textbf{nonlinear mixed effect models}, NLME. The nonlinearity means that it can handle virtually any type of structural model, usually highly non-linear. Additionally one can consider population or subject related factors, known \emph{a priori} or collected during the study, which can be divided into two groups:
\begin{itemize}
\item
\textbf{fixed effects} -- population averages, e.g. typical/population value for volume, and other group or even subject specific explanatory variables, such as treatment groups, gender or weight, see covariate model in section \ref{maths:covariate_model}.
\item
\textbf{random effects} -- subject/occasion specific, e.g. \textit{inter-individual} or \textit{inter-individual within subject within centre variability}, see section \ref{sec:variabilityModel} on variability.
\end{itemize}
The notation of fixed versus random effects might be at first confusing as the former account for population, group but also subject characteristics. As explained in the parameter model section, the values of individual characteristics are subject specific features but the parameters assigned to them are identical for a group or population. \\
The structure of this chapter is the following, in section \ref{sec:continuousDataModel} we formulate a general nonlinear mixed effects model for continuous data, section \ref{sec:structuralModel} introduces the structural model, section \ref{sec:variabilityModel} discusses the variability as nested hierarchy, section \ref{sec:parameterModel} is about the parameter model, with discussion on correlation of random effects, covariate model and a comparison of equivalent representations of the parameter model and section \ref{sec:residualErrorModel} is about the residual error model. 
% and last section \ref{sec:CTS} about the trial design model.


\input{input/continuousDataModel_specSection}

\input{input/structuralModel_specSection}

\input{input/variabilityLevels_specSection}

\input{input/parameterRepresentation_specSection}

\input{input/observationModel_specSection}


%\paragraph{Covariate model}
%Covariate model is barely covered so far. See also \cite{Keizer:2011aa}. Missing are following features:\\
%For categorical covariates:\\
%-- categorical distribution of categorical covariates \\
%---- estimating categorical distribution from external data file \\
%---- sampling from known categorical distribution \\
%---- clusters of categorical covariates \\
%For continuous covariates:\\
%-- power-normal distribution for continuous covariates \\
%---- estimating parameters $\lambda$,$\mu$,$\sigma$ from external data file \\
%---- sampling from known power-normal distribution \\
%---- conditional distribution of continuous covariates \\
%------ none \\
%------ defined \\
%------ to be estimated \\
%---- selecting criteria for continuous covariates \\
%---- dependent distribution of continuous covariates \\
%---- correlated continuous covariates \\
%For both types: \\
%-- selection/exclusion criteria missing \\
%
%\subsection{Observation model}
%- Name\\
%- Units\\
%- Observation types - continuous/discrete\\
%- Symbol of predicted output\\
%
%\subsection{Task model}
%-- Combination of tasks, e.g.\\
%1. estimate distribution of covariate from experimental data\\
%2. Simulation task using the estimated PDF
%
%
%\subsection{Not covered so far}
%- correlation of residual errors \\
%---- number models of relevant models identified and described in Use Case document\\
%
